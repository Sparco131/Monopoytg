<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∏–Ω–∏-–ú–æ–Ω–æ–ø–æ–ª–∏—è</title>
    <style>
        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 10px;
            background-color: #f0e6d2;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            box-sizing: border-box;
        }

        h1 {
            color: #2c3e50;
            font-size: 28px;
            margin: 10px 0;
            text-transform: uppercase;
            font-weight: bold;
        }

        .auth-form, .lobby, .game-interface {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
            width: 100%;
            max-width: 300px;
        }

        .auth-form input, .lobby input {
            padding: 10px;
            font-size: 16px;
            border: 2px solid #2c3e50;
            border-radius: 10px;
        }

        .auth-form button, .lobby button, .actions button {
            padding: 10px;
            font-size: 16px;
            border: none;
            border-radius: 10px;
            background-color: #3498db;
            color: white;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            transition: background-color 0.2s ease;
        }

        .auth-form button:hover, .lobby button:hover, .actions button:hover {
            background-color: #2980b9;
        }

        .session-list {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .session-item {
            padding: 10px;
            background-color: #ffffff;
            border: 2px solid #2c3e50;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .session-item:hover {
            background-color: #f0f0f0;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            width: 100%;
            max-width: 300px;
            margin-bottom: 15px;
        }

        .cell {
            border: 2px solid #2c3e50;
            padding: 10px;
            text-align: center;
            background-color: #ffffff;
            border-radius: 10px;
            font-size: 14px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }

        .cell:hover {
            transform: scale(1.05);
        }

        .cell.start {
            background-color: #27ae60;
            color: white;
        }

        .cell.property {
            background-color: #3498db;
            color: white;
        }

        .cell.jail {
            background-color: #e74c3c;
            color: white;
        }

        .player-info {
            margin-bottom: 15px;
            text-align: center;
            font-size: 16px;
            background-color: #ffffff;
            padding: 10px;
            border-radius: 10px;
            border: 2px solid #2c3e50;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
        }

        .player-info p {
            margin: 5px 0;
            color: #2c3e50;
        }

        .actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
            max-width: 300px;
        }

        .actions button {
            background-color: #e67e22;
        }

        .actions button:hover {
            background-color: #d35400;
        }

        .log {
            width: 100%;
            max-width: 300px;
            height: 100px;
            border: 2px solid #2c3e50;
            padding: 10px;
            overflow-y: auto;
            background-color: #ffffff;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 14px;
        }

        .log p {
            margin: 0;
            color: #2c3e50;
        }

        .cell.start::before {
            content: "üèÅ";
            font-size: 20px;
            display: block;
            margin-bottom: 5px;
        }

        .cell.property::before {
            content: "üè†";
            font-size: 20px;
            display: block;
            margin-bottom: 5px;
        }

        .cell.jail::before {
            content: "üöì";
            font-size: 20px;
            display: block;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <h1>–ú–∏–Ω–∏-–ú–æ–Ω–æ–ø–æ–ª–∏—è</h1>

    <!-- –§–æ—Ä–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div class="auth-form" id="authForm">
        <input type="text" id="username" placeholder="–ò–º—è –∏–≥—Ä–æ–∫–∞" required>
        <button onclick="login()">–í–æ–π—Ç–∏</button>
    </div>

    <!-- –õ–æ–±–±–∏ (—Å–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div class="lobby" id="lobby" style="display: none;">
        <h2>–õ–æ–±–±–∏</h2>
        <button onclick="createSession()">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é</button>
        <div class="session-list" id="sessionList">
            <!-- –°–ø–∏—Å–æ–∫ —Å–µ—Å—Å–∏–π –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
        </div>
    </div>

    <!-- –ò–≥—Ä–æ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (—Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div id="gameInterface" style="display: none;">
        <div class="board">
            <div class="cell start">–°—Ç–∞—Ä—Ç</div>
            <div class="cell property">–£–ª–∏—Ü–∞ 1</div>
            <div class="cell property">–£–ª–∏—Ü–∞ 2</div>
            <div class="cell jail">–¢—é—Ä—å–º–∞</div>
            <div class="cell property">–£–ª–∏—Ü–∞ 3</div>
            <div class="cell property">–£–ª–∏—Ü–∞ 4</div>
        </div>

        <div class="player-info">
            <h2>–ò–≥—Ä–æ–∫: <span id="playerName"></span></h2>
            <p>–î–µ–Ω—å–≥–∏: $<span id="money">1500</span></p>
            <p>–°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å: <span id="properties">–ù–µ—Ç</span></p>
            <p>–ü–æ–∑–∏—Ü–∏—è: <span id="position">–°—Ç–∞—Ä—Ç</span></p>
        </div>

        <div class="actions">
            <button onclick="rollDice()">–ë—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫</button>
            <button onclick="buyProperty()">–ö—É–ø–∏—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å</button>
            <button onclick="buildHouse()">–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –¥–æ–º</button>
        </div>

        <div class="log" id="log">
            <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∏–≥—Ä—É!</p>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä—ã
        const board = [
            { name: "–°—Ç–∞—Ä—Ç", type: "start", price: 0, owner: null, houses: 0 },
            { name: "–£–ª–∏—Ü–∞ 1", type: "property", price: 200, owner: null, houses: 0 },
            { name: "–£–ª–∏—Ü–∞ 2", type: "property", price: 200, owner: null, houses: 0 },
            { name: "–¢—é—Ä—å–º–∞", type: "jail", price: 0, owner: null, houses: 0 },
            { name: "–£–ª–∏—Ü–∞ 3", type: "property", price: 300, owner: null, houses: 0 },
            { name: "–£–ª–∏—Ü–∞ 4", type: "property", price: 300, owner: null, houses: 0 },
        ];

        let player = {
            username: "",
            money: 1500,
            position: 0,
            properties: [],
            inJail: false,
        };

        let currentSessionId = null;

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const authForm = document.getElementById("authForm");
        const lobby = document.getElementById("lobby");
        const gameInterface = document.getElementById("gameInterface");
        const sessionList = document.getElementById("sessionList");
        const playerNameElement = document.getElementById("playerName");
        const moneyElement = document.getElementById("money");
        const propertiesElement = document.getElementById("properties");
        const positionElement = document.getElementById("position");
        const logElement = document.getElementById("log");

        // –õ–æ–≥–∏–Ω –∏–≥—Ä–æ–∫–∞
        function login() {
            const username = document.getElementById("username").value.trim();
            if (!username) {
                alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏–≥—Ä–æ–∫–∞!");
                return;
            }

            player.username = username;
            authForm.style.display = "none";
            lobby.style.display = "block";
            loadSessions();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Å–µ—Å—Å–∏–π
        function loadSessions() {
            const sessions = JSON.parse(localStorage.getItem("sessions")) || [];
            sessionList.innerHTML = "";

            if (sessions.length === 0) {
                sessionList.innerHTML = "<p>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π.</p>";
                return;
            }

            sessions.forEach(session => {
                const sessionItem = document.createElement("div");
                sessionItem.className = "session-item";
                sessionItem.textContent = `–°–µ—Å—Å–∏—è #${session.id} (–ò–≥—Ä–æ–∫–æ–≤: ${session.players.length})`;
                sessionItem.onclick = () => joinSession(session.id);
                sessionList.appendChild(sessionItem);
            });
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏
        function createSession() {
            const sessionId = Date.now().toString(); // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Å–µ—Å—Å–∏–∏
            const newSession = {
                id: sessionId,
                players: [player.username],
                board: JSON.parse(JSON.stringify(board)), // –ö–æ–ø–∏—è –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
            };

            const sessions = JSON.parse(localStorage.getItem("sessions")) || [];
            sessions.push(newSession);
            localStorage.setItem("sessions", JSON.stringify(sessions));

            currentSessionId = sessionId;
            lobby.style.display = "none";
            gameInterface.style.display = "block";
            addLogMessage(`–°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è —Å–µ—Å—Å–∏—è #${sessionId}`);
        }

        // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ —Å–µ—Å—Å–∏–∏
        function joinSession(sessionId) {
            const sessions = JSON.parse(localStorage.getItem("sessions")) || [];
            const session = sessions.find(s => s.id === sessionId);

            if (!session) {
                alert("–°–µ—Å—Å–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!");
                return;
            }

            if (session.players.includes(player.username)) {
                alert("–í—ã —É–∂–µ –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏!");
                return;
            }

            session.players.push(player.username);
            localStorage.setItem("sessions", JSON.stringify(sessions));

            currentSessionId = sessionId;
            lobby.style.display = "none";
            gameInterface.style.display = "block";
            addLogMessage(`–í—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ —Å–µ—Å—Å–∏–∏ #${sessionId}`);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∏–≥—Ä–æ–∫–µ
        function updatePlayerInfo() {
            moneyElement.textContent = player.money;
            propertiesElement.textContent = player.properties.join(", ") || "–ù–µ—Ç";
            positionElement.textContent = board[player.position].name;
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª–æ–≥
        function addLogMessage(message) {
            const p = document.createElement("p");
            p.textContent = message;
            logElement.appendChild(p);
            logElement.scrollTop = logElement.scrollHeight;
        }

        // –ë—Ä–æ—Å–æ–∫ –∫—É–±–∏–∫–∞
        function rollDice() {
            if (player.inJail) {
                addLogMessage("–í—ã –≤ —Ç—é—Ä—å–º–µ –∏ –Ω–µ –º–æ–∂–µ—Ç–µ –±—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫!");
                return;
            }

            const dice = Math.floor(Math.random() * 6) + 1;
            player.position = (player.position + dice) % board.length;
            const cell = board[player.position];

            addLogMessage(`–í—ã –±—Ä–æ—Å–∏–ª–∏ –∫—É–±–∏–∫ –∏ –≤—ã–ø–∞–ª–æ ${dice}. –í—ã –Ω–∞ –∫–ª–µ—Ç–∫–µ: ${cell.name}`);

            if (cell.type === "jail") {
                player.inJail = true;
                addLogMessage("–í—ã –ø–æ–ø–∞–ª–∏ –≤ —Ç—é—Ä—å–º—É!");
            } else if (cell.type === "property" && cell.owner !== null && cell.owner !== player.username) {
                const rent = cell.price * 0.1;
                player.money -= rent;
                addLogMessage(`–í—ã –∑–∞–ø–ª–∞—Ç–∏–ª–∏ –∞—Ä–µ–Ω–¥—É: $${rent}`);
            }

            updatePlayerInfo();
        }

        // –ü–æ–∫—É–ø–∫–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
        function buyProperty() {
            const cell = board[player.position];
            if (cell.type !== "property" || cell.owner !== null) {
                addLogMessage("–ü–æ–∫—É–ø–∫–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞.");
                return;
            }

            if (player.money >= cell.price) {
                cell.owner = player.username;
                player.money -= cell.price;
                player.properties.push(cell.name);
                addLogMessage(`–í—ã –∫—É–ø–∏–ª–∏ ${cell.name} –∑–∞ $${cell.price}`);
            } else {
                addLogMessage("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥ –¥–ª—è –ø–æ–∫—É–ø–∫–∏.");
            }

            updatePlayerInfo();
        }

        // –ü–æ—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–º–∞
        function buildHouse() {
            const cell = board[player.position];
            if (cell.owner !== player.username || player.money < 100) {
                addLogMessage("–ü–æ—Å—Ç—Ä–æ–π–∫–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞.");
                return;
            }

            cell.houses += 1;
            player.money -= 100;
            addLogMessage(`–í—ã –ø–æ—Å—Ç—Ä–æ–∏–ª–∏ –¥–æ–º –Ω–∞ ${cell.name} –∑–∞ $100`);
            updatePlayerInfo();
        }

        // –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram WebApp
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
    </script>
</body>
</html>
