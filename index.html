from flask import Flask, jsonify, request, render_template
from flask_cors import CORS

app = Flask(__name__)
CORS(app)  # Разрешить запросы с любого домена

# Пример данных игры
game_data = {
    "money": 1500,
    "position": 0,
    "cell": "Старт",
    "board": [
        {"name": "Старт", "owner": None, "houses": 0},
        {"name": "Улица 1", "owner": None, "houses": 0},
        {"name": "Улица 2", "owner": None, "houses": 0},
        {"name": "Тюрьма", "owner": None, "houses": 0},
    ]
}

# Пример данных профиля
profile_data = {
    "money": 1500,
    "properties": [
        {"name": "Улица 1", "houses": 0},
        {"name": "Улица 2", "houses": 1}
    ],
    "achievements": ["Первый дом", "Покупка клетки"]
}

# Главная страница
@app.route('/')
def index():
    return render_template('index.html')  # Рендеринг HTML-файла

# Маршрут для получения статуса игры
@app.route('/game-status', methods=['GET'])
def game_status():
    return jsonify(game_data)

# Маршрут для броска кубика
@app.route('/roll-dice', methods=['POST'])
def roll_dice():
    import random
    dice = random.randint(1, 6)
    game_data["position"] = (game_data["position"] + dice) % len(game_data["board"])
    game_data["cell"] = game_data["board"][game_data["position"]]["name"]
    return jsonify({"dice": dice, "cell": game_data["cell"]})

# Маршрут для покупки клетки
@app.route('/buy-property', methods=['POST'])
def buy_property():
    cell = game_data["board"][game_data["position"]]
    if cell["owner"] is None:
        cell["owner"] = "Игрок"
        game_data["money"] -= 200  # Пример стоимости клетки
        return jsonify({"message": "Клетка куплена!"})
    else:
        return jsonify({"message": "Клетка уже занята."})

# Маршрут для постройки дома
@app.route('/build-house', methods=['POST'])
def build_house():
    cell = game_data["board"][game_data["position"]]
    if cell["owner"] == "Игрок":
        cell["houses"] += 1
        game_data["money"] -= 100  # Пример стоимости дома
        return jsonify({"message": "Дом построен!"})
    else:
        return jsonify({"message": "Вы не владеете этой клеткой."})

# Маршрут для торговли (заглушка)
@app.route('/trade', methods=['POST'])
def trade():
    return jsonify({"message": "Торговля пока не реализована."})

# Маршрут для получения профиля игрока
@app.route('/profile', methods=['GET'])
def profile():
    return jsonify(profile_data)

# Запуск сервера
if __name__ == '__main__':
    app.run(debug=True)
