<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Monopoly</title>
    <style>
        /* Общие стили */
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            color: white;
            overflow: hidden;
        }

        /* Контейнер для меню */
        .menu-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 90%;
            width: 100%;
            animation: fadeIn 1s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .menu-container h1 {
            font-size: 2rem;
            margin-bottom: 15px;
            color: white;
            text-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        .menu-container label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.8);
            text-align: left;
        }

        .menu-container select,
        .menu-container input {
            width: 100%;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            font-size: 1rem;
            margin-bottom: 15px;
            box-sizing: border-box;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transition: border-color 0.3s ease, background 0.3s ease;
        }

        .menu-container select:hover,
        .menu-container input:hover {
            border-color: rgba(255, 255, 255, 0.5);
        }

        .menu-container select:focus,
        .menu-container input:focus {
            border-color: #6a11cb;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
        }

        .menu-container button {
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            margin: 5px;
        }

        .menu-container button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .menu-container button:active {
            transform: translateY(0);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        /* Модальные окна */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            color: black;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .modal-content label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
            color: #333;
            text-align: left;
        }

        .modal-content input,
        .modal-content select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1rem;
        }

        .modal-content button {
            margin: 5px;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #6a11cb;
            color: white;
        }

        .modal-content button:hover {
            background: #2575fc;
        }

        /* Игровое поле и другие стили */
        .board-container {
            display: none;
            width: 90%;
            max-width: 400px;
            aspect-ratio: 1;
            position: relative;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            margin-top: 20px;
        }

        .board {
            width: 100%;
            height: 100%;
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            grid-template-rows: repeat(12, 1fr);
            background: #f0f0f0;
            box-sizing: border-box;
            gap: 0;
        }

        .cell {
            display: flex;
            justify-content: center;
            align-items: center;
            border: none;
            font-size: 8px;
            text-align: center;
            padding: 0;
            box-sizing: border-box;
            background: white;
            color: #333;
            transition: background 0.3s ease;
            box-shadow: 0 0 1px rgba(0, 0, 0, 0.1);
        }

        .cell:hover {
            background: #f9f9f9;
        }

        .corner {
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            color: white;
            font-weight: bold;
            font-size: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 5px;
            box-sizing: border-box;
        }

        .cell.lottery {
            background: #ffcc00;
            color: black;
            font-weight: bold;
        }

        .cell.empty {
            background: #f0f0f0;
            color: #999;
            font-size: 8px;
            text-align: center;
            padding: 5px;
            box-sizing: border-box;
        }

        .player {
            position: absolute;
            width: 4%;
            height: 4%;
            border-radius: 50%;
            transition: all 0.5s ease;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }

        .player.active {
            border: 2px solid #fff;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
        }

        #player1 {
            background: #ff6b6b;
        }

        #player2 {
            background: #4ecdc4;
        }

        #player3 {
            background: #ffe66d;
        }

        #player4 {
            background: #ff9f43;
        }

        .dice-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: 10px;
            z-index: 10;
        }

        .dice {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 2px solid #333;
            border-radius: 10px;
            text-align: center;
            line-height: 40px;
            font-size: 20px;
            background: white;
            color: #333;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
            animation: rollDice 1s ease-in-out;
        }

        @keyframes rollDice {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .controls {
            display: none;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin-top: 20px;
            margin-bottom: 20px;
            width: 90%;
            max-width: 400px;
        }

        .controls button {
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: background 0.3s ease;
            flex: 1 1 auto;
            min-width: 80px;
            text-align: center;
        }

        .controls button:hover {
            background: linear-gradient(135deg, #2575fc, #6a11cb);
        }

        .log-container {
            width: 100%;
            max-height: 100px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 10px;
            box-sizing: border-box;
            overflow-y: auto;
            margin-top: 10px;
        }

        .log-content {
            font-size: 12px;
            color: #333;
            line-height: 1.5;
        }

        .log-message {
            margin-bottom: 5px;
            padding: 5px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 5px;
        }

        @media (max-width: 600px) {
            .menu-container {
                padding: 15px;
                border-radius: 10px;
            }

            .menu-container h1 {
                font-size: 1.5rem;
            }

            .menu-container button {
                padding: 10px 20px;
                font-size: 0.9rem;
            }

            .cell {
                font-size: 6px;
            }

            .corner {
                font-size: 8px;
            }

            .board-container {
                max-width: 90%;
                border-radius: 10px;
                margin-top: 10px;
            }

            .dice {
                width: 30px;
                height: 30px;
                font-size: 16px;
                line-height: 30px;
            }

            .controls button {
                padding: 6px 12px;
                font-size: 0.7rem;
                min-width: 70px;
            }

            .controls {
                gap: 6px;
                margin-top: 10px;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Меню -->
    <div class="menu-container" id="menu">
        <h1>Modern Monopoly</h1>

        <!-- Основные настройки -->
        <label for="mode">Выберите режим:</label>
        <select id="mode">
            <option value="classic">Классический</option>
            <option value="fast">Быстрый</option>
        </select>

        <label for="players">Количество игроков (включая ботов):</label>
        <input type="number" id="players" min="1" max="4" value="2">

        <!-- Кнопка "Настройка сессии" -->
        <button onclick="openSessionSettings()">Настройка сессии</button>

        <!-- Кнопка "Начать игру" -->
        <button onclick="startGame()">Начать игру</button>
    </div>

    <!-- Модальное окно для настроек сессии -->
    <div id="session-settings-modal" class="modal">
        <div class="modal-content">
            <h2>Настройка сессии</h2>

            <!-- Дополнительные настройки -->
            <label for="startingMoney">Стартовый капитал:</label>
            <input type="number" id="startingMoney" min="500" max="5000" value="1500">

            <label for="maxHouses">Максимум домов на улице:</label>
            <input type="number" id="maxHouses" min="1" max="5" value="4">

            <label for="enableAuctions">Включить аукционы:</label>
            <input type="checkbox" id="enableAuctions" checked>

            <label for="botDifficulty">Сложность ботов:</label>
            <select id="botDifficulty">
                <option value="easy">Легкая</option>
                <option value="medium">Средняя</option>
                <option value="hard">Сложная</option>
            </select>

            <!-- Кнопки для закрытия и сохранения -->
            <button onclick="closeSessionSettings()">Закрыть</button>
            <button onclick="saveSessionSettings()">Сохранить</button>
        </div>
    </div>

    <!-- Игровое поле -->
    <div class="board-container" id="board-container">
        <div class="board">
            <!-- Угловые клетки -->
            <div class="cell corner" style="grid-column: 1 / 2; grid-row: 1 / 2;">Старт</div>
            <div class="cell empty" style="grid-column: 2 / 3; grid-row: 1 / 2;">Дорога</div> <!-- Новая клетка справа от Старта -->
            <div class="cell empty" style="grid-column: 1 / 2; grid-row: 2 / 3;">Дорога</div> <!-- Существующая клетка под Стартом -->
            <div class="cell empty" style="grid-column: 11 / 12; grid-row: 1 / 2;">Дорога</div> <!-- Новая клетка слева от Идите в тюрьму -->
            <div class="cell corner" style="grid-column: 12 / 13; grid-row: 1 / 2;">Идите в тюрьму</div>
            <div class="cell empty" style="grid-column: 12 / 13; grid-row: 2 / 3;">Дорога</div> <!-- Новая клетка под Идите в тюрьму -->
            <div class="cell corner" style="grid-column: 12 / 13; grid-row: 12 / 13;">Бесплатная парковка</div>
            <div class="cell corner" style="grid-column: 1 / 2; grid-row: 12 / 13;">Тюрьма</div>

            <!-- Остальные клетки -->
            <div class="cell property" style="grid-column: 3 / 4; grid-row: 12 / 13;">Улица 1 (60$)</div>
            <div class="cell property" style="grid-column: 4 / 5; grid-row: 12 / 13;">Улица 2 (60$)</div>
            <div class="cell property" style="grid-column: 5 / 6; grid-row: 12 / 13;">Улица 3 (100$)</div>
            <div class="cell property" style="grid-column: 6 / 7; grid-row: 12 / 13;">Улица 4 (100$)</div>
            <div class="cell property" style="grid-column: 7 / 8; grid-row: 12 / 13;">Улица 5 (140$)</div>
            <div class="cell property" style="grid-column: 8 / 9; grid-row: 12 / 13;">Улица 6 (140$)</div>
            <div class="cell property" style="grid-column: 9 / 10; grid-row: 12 / 13;">Улица 7 (180$)</div>
            <div class="cell property" style="grid-column: 10 / 11; grid-row: 12 / 13;">Улица 8 (220$)</div>

            <!-- Левая сторона (снизу вверх) -->
            <div class="cell property" style="grid-column: 1 / 2; grid-row: 10 / 11;">Железная дорога 1 (200$)</div>
            <div class="cell property" style="grid-column: 1 / 2; grid-row: 9 / 10;">Железная дорога 2 (200$)</div>
            <div class="cell property" style="grid-column: 1 / 2; grid-row: 8 / 9;">Железная дорога 3 (200$)</div>
            <div class="cell property" style="grid-column: 1 / 2; grid-row: 7 / 8;">Железная дорога 4 (200$)</div>
            <div class="cell property" style="grid-column: 1 / 2; grid-row: 6 / 7;">Электростанция (150$)</div>
            <div class="cell property" style="grid-column: 1 / 2; grid-row: 5 / 6;">Водоканал (150$)</div>
            <div class="cell property" style="grid-column: 1 / 2; grid-row: 4 / 5;">Шанс</div>
            <div class="cell property" style="grid-column: 1 / 2; grid-row: 3 / 4;">Общественная казна</div>

            <!-- Верхняя сторона (справа налево) -->
            <div class="cell property" style="grid-column: 3 / 4; grid-row: 1 / 2;">Улица 9 (240$)</div>
            <div class="cell property" style="grid-column: 4 / 5; grid-row: 1 / 2;">Улица 10 (260$)</div>
            <div class="cell property" style="grid-column: 5 / 6; grid-row: 1 / 2;">Улица 11 (280$)</div>
            <div class="cell property" style="grid-column: 6 / 7; grid-row: 1 / 2;">Улица 12 (300$)</div>
            <div class="cell property" style="grid-column: 7 / 8; grid-row: 1 / 2;">Налог (200$)</div>
            <div class="cell property" style="grid-column: 8 / 9; grid-row: 1 / 2;">Налог (100$)</div>
            <div class="cell property" style="grid-column: 9 / 10; grid-row: 1 / 2;">Улица 13 (320$)</div>
            <div class="cell property" style="grid-column: 10 / 11; grid-row: 1 / 2;">Улица 14 (350$)</div>

            <!-- Правая сторона (сверху вниз) -->
            <div class="cell property" style="grid-column: 12 / 13; grid-row: 3 / 4;">Шанс</div>
            <div class="cell lottery" style="grid-column: 12 / 13; grid-row: 4 / 5;">Лотерея</div>
            <div class="cell property" style="grid-column: 12 / 13; grid-row: 5 / 6;">Электростанция (150$)</div>
            <div class="cell property" style="grid-column: 12 / 13; grid-row: 6 / 7;">Водоканал (150$)</div>
            <div class="cell property" style="grid-column: 12 / 13; grid-row: 7 / 8;">Железная дорога 1 (200$)</div>
            <div class="cell property" style="grid-column: 12 / 13; grid-row: 8 / 9;">Железная дорога 2 (200$)</div>
            <div class="cell property" style="grid-column: 12 / 13; grid-row: 9 / 10;">Железная дорога 3 (200$)</div>
            <div class="cell property" style="grid-column: 12 / 13; grid-row: 10 / 11;">Железная дорога 4 (200$)</div>

            <!-- Новая клетка над Бесплатной парковкой -->
            <div class="cell empty" style="grid-column: 12 / 13; grid-row: 11 / 12;">Дорога</div>

            <!-- Новая клетка слева от Бесплатной парковки -->
            <div class="cell property" style="grid-column: 10 / 11; grid-row: 12 / 13;">Улица 15 (400$)</div> <!-- Новая клетка с улицей -->
            <div class="cell empty" style="grid-column: 11 / 12; grid-row: 12 / 13;">Дорога</div> <!-- Сдвинутая клетка "Дорога" -->

            <!-- Игроки -->
            <div id="player1" class="player"></div>
            <div id="player2" class="player"></div>
            <div id="player3" class="player"></div>
            <div id="player4" class="player"></div>

            <!-- Кубики -->
            <div class="dice-container">
                <div id="dice1" class="dice">1</div>
                <div id="dice2" class="dice">1</div>
            </div>
        </div>
    </div>

    <!-- Кнопки и лог -->
    <div class="controls" id="controls">
        <button class="roll-button" onclick="rollDice()">Бросить кубики</button>
        <button onclick="buyProperty()">Купить</button>
        <button onclick="skipTurn()">Пропустить</button>
        <button onclick="endTurn()">Завершить ход</button>
        <button onclick="trade()">Торговать</button>
        <button onclick="buildHouses()">Строить дома</button>
        <button onclick="mortgageProperty()">Заложить</button>

        <!-- Лог -->
        <div class="log-container">
            <div class="log-content" id="log-content"></div>
        </div>
    </div>

    <script>
        // Элементы меню и поля
        const menu = document.getElementById('menu');
        const boardContainer = document.getElementById('board-container');
        const controls = document.getElementById('controls');
        const dice1Element = document.getElementById('dice1');
        const dice2Element = document.getElementById('dice2');
        const logContent = document.getElementById('log-content');

        // Игроки и боты
        let players = [];
        let currentPlayerIndex = 0;
        let gameSettings = {
            startingMoney: 1500,
            maxHouses: 4,
            enableAuctions: true,
            botDifficulty: "medium",
        };

        // Функция для добавления сообщения в лог
        function addLogMessage(message) {
            const logMessage = document.createElement('div');
            logMessage.className = 'log-message';
            logMessage.textContent = message;
            logContent.appendChild(logMessage);

            // Автоматическая прокрутка вниз
            logContent.scrollTop = logContent.scrollHeight;
        }

        // Начало игры
        function startGame() {
            const mode = document.getElementById('mode').value;
            const playersCount = parseInt(document.getElementById('players').value);

            // Скрываем меню и показываем поле и кнопки
            menu.style.display = 'none';
            boardContainer.style.display = 'block';
            controls.style.display = 'flex';

            // Инициализация игры с настройками
            initGame(mode, playersCount);
        }

        // Инициализация игры
        function initGame(mode, playersCount) {
            players = [];
            for (let i = 1; i <= playersCount; i++) {
                players.push({
                    id: `player${i}`,
                    position: 0,
                    money: gameSettings.startingMoney,
                    isBot: i > 1,
                    properties: [],
                    botDifficulty: gameSettings.botDifficulty,
                });
            }

            currentPlayerIndex = 0;
            highlightActivePlayer();
            if (players[currentPlayerIndex].isBot) {
                botTurn();
            }
        }

        // Подсветка активного игрока
        function highlightActivePlayer() {
            document.querySelectorAll('.player').forEach(player => player.classList.remove('active'));
            const activePlayer = document.getElementById(players[currentPlayerIndex].id);
            activePlayer.classList.add('active');
        }

        // Ход бота
        function botTurn() {
            setTimeout(() => {
                const bot = players[currentPlayerIndex];
                const dice1 = Math.floor(Math.random() * 6) + 1;
                const dice2 = Math.floor(Math.random() * 6) + 1;
                const steps = dice1 + dice2;

                movePlayer(bot, steps);
                addLogMessage(`Бот ${bot.id} бросил кубики: ${dice1} и ${dice2}, шаги: ${steps}`);

                // Логика для ботов в зависимости от сложности
                const currentCell = getCellData(bot.position);
                if (currentCell.type === "property" && !currentCell.owner) {
                    if (bot.botDifficulty === "easy" && Math.random() < 0.3) {
                        buyProperty();
                    } else if (bot.botDifficulty === "medium" && Math.random() < 0.6) {
                        buyProperty();
                    } else if (bot.botDifficulty === "hard") {
                        buyProperty();
                    }
                }

                // Бот автоматически завершает ход
                endTurn();
            }, 3000); // Задержка хода бота: 3 секунды
        }

        // Переход хода
        function nextTurn() {
            currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
            highlightActivePlayer();
            if (players[currentPlayerIndex].isBot) {
                botTurn();
            } else {
                addLogMessage(`Ход игрока ${players[currentPlayerIndex].id}.`);
            }
        }

        // Функция для завершения хода
        function endTurn() {
            const currentPlayer = players[currentPlayerIndex];
            addLogMessage(`${currentPlayer.id} завершил ход.`);
            nextTurn();
        }

        // Функция для броска кубиков
        function rollDice() {
            const currentPlayer = players[currentPlayerIndex];
            if (currentPlayer.isBot) return;

            let dice1 = 0, dice2 = 0;
            const interval = setInterval(() => {
                dice1 = Math.floor(Math.random() * 6) + 1;
                dice2 = Math.floor(Math.random() * 6) + 1;
                dice1Element.textContent = dice1;
                dice2Element.textContent = dice2;
            }, 100);

            setTimeout(() => {
                clearInterval(interval);
                const steps = dice1 + dice2;
                movePlayer(currentPlayer, steps);
                addLogMessage(`Игрок ${currentPlayer.id} бросил кубики: ${dice1} и ${dice2}, шаги: ${steps}`);

                // Проверяем, можно ли купить клетку
                const currentCell = getCellData(currentPlayer.position);
                if (currentCell.type === "property" && !currentCell.owner) {
                    addLogMessage(`${currentPlayer.id}, вы можете купить ${currentCell.name} за ${currentCell.price}$. Нажмите "Купить", чтобы приобрести.`);
                } else {
                    // Если клетка не для покупки, предлагаем завершить ход
                    addLogMessage(`${currentPlayer.id}, нажмите "Завершить ход", чтобы закончить ход.`);
                }
            }, 2000);
        }

        // Функция для перемещения игрока
        function movePlayer(player, steps) {
            const newPosition = (player.position + steps) % 40;
            player.position = newPosition;

            const playerElement = document.getElementById(player.id);
            const board = document.querySelector('.board');
            const cellSize = board.offsetWidth / 12;
            const cell = getCellPosition(newPosition);
            playerElement.style.left = `${cell.x * cellSize}px`;
            playerElement.style.top = `${cell.y * cellSize}px`;

            const currentCell = document.querySelector(`.cell[style*="grid-column: ${cell.x + 1} / ${cell.x + 2}"][style*="grid-row: ${cell.y + 1} / ${cell.y + 2}"]`);
            if (currentCell.classList.contains('lottery')) {
                handleLotteryCell(player);
            } else {
                handleCellAction(player, newPosition);
            }
        }

        // Обработка действий на клетке
        function handleCellAction(player, position) {
            const cell = getCellData(position);
            if (cell.type === "empty") {
                addLogMessage(`${player.id} прошел по дороге. Ничего не произошло.`);
            } else if (cell.type === "property" && cell.owner && cell.owner !== player) {
                const rent = cell.rent;
                if (player.money >= rent) {
                    player.money -= rent;
                    cell.owner.money += rent;
                    addLogMessage(`${player.id} заплатил аренду ${cell.owner.id} в размере ${rent}$`);
                } else {
                    addLogMessage(`${player.id} объявил банкротство!`);
                    handleBankruptcy(player);
                }
            } else if (cell.type === "tax") {
                player.money -= cell.amount;
                addLogMessage(`${player.id} заплатил налог в размере ${cell.amount}$`);
            } else if (cell.type === "chance" || cell.type === "community_chest") {
                const card = drawCard(cell.type);
                addLogMessage(`${player.id} вытянул карточку: ${card}`);
                handleCardEffect(player, card);
            }
        }

        // Получение данных о клетке
        function getCellData(index) {
            const cells = [
                { type: "start", name: "Старт" },
                { type: "empty", name: "Дорога" }, // Новая клетка справа от Старта
                { type: "empty", name: "Дорога" }, // Существующая клетка под Стартом
                { type: "property", name: "Улица 1", price: 60, rent: 10 },
                { type: "property", name: "Улица 2", price: 60, rent: 10 },
                { type: "property", name: "Улица 3", price: 100, rent: 20 },
                { type: "property", name: "Улица 4", price: 100, rent: 20 },
                { type: "property", name: "Улица 5", price: 140, rent: 30 },
                { type: "property", name: "Улица 6", price: 140, rent: 30 },
                { type: "property", name: "Улица 7", price: 180, rent: 40 },
                { type: "railroad", name: "Железная дорога 1", price: 200, rent: 50 },
                { type: "railroad", name: "Железная дорога 2", price: 200, rent: 50 },
                { type: "railroad", name: "Железная дорога 3", price: 200, rent: 50 },
                { type: "railroad", name: "Железная дорога 4", price: 200, rent: 50 },
                { type: "utility", name: "Электростанция", price: 150, rent: 25 },
                { type: "utility", name: "Водоканал", price: 150, rent: 25 },
                { type: "chance", name: "Шанс" },
                { type: "lottery", name: "Лотерея" },
                { type: "tax", name: "Налог", amount: 200 },
                { type: "tax", name: "Налог", amount: 100 },
                { type: "jail", name: "Тюрьма" },
                { type: "free_parking", name: "Бесплатная парковка" },
                { type: "go_to_jail", name: "Идите в тюрьму" },
                { type: "empty", name: "Дорога" }, // Новая клетка слева от Идите в тюрьму
                { type: "empty", name: "Дорога" }, // Новая клетка под Идите в тюрьму
                { type: "property", name: "Улица 8", price: 220, rent: 45 },
                { type: "property", name: "Улица 9", price: 240, rent: 50 },
                { type: "property", name: "Улица 10", price: 260, rent: 55 },
                { type: "property", name: "Улица 11", price: 280, rent: 60 },
                { type: "property", name: "Улица 12", price: 300, rent: 65 },
                { type: "empty", name: "Дорога" }, // Новая клетка над Бесплатной парковкой
                { type: "property", name: "Улица 15", price: 400, rent: 80 }, // Новая клетка с улицей
                { type: "empty", name: "Дорога" }, // Сдвинутая клетка "Дорога"
            ];
            return cells[index];
        }

        // Получение координат клетки
        function getCellPosition(index) {
            const positions = [
                { x: 0, y: 0 }, // Старт
                { x: 1, y: 0 }, // Новая клетка справа от Старта
                { x: 0, y: 1 }, // Существующая клетка под Стартом
                { x: 2, y: 0 }, // Улица 1
                { x: 3, y: 0 }, // Улица 2
                { x: 4, y: 0 }, // Улица 3
                { x: 5, y: 0 }, // Улица 4
                { x: 6, y: 0 }, // Улица 5
                { x: 7, y: 0 }, // Улица 6
                { x: 8, y: 0 }, // Улица 7
                { x: 9, y: 0 }, // Железная дорога 1
                { x: 10, y: 0 }, // Железная дорога 2
                { x: 11, y: 0 }, // Железная дорога 3
                { x: 11, y: 1 }, // Железная дорога 4
                { x: 11, y: 2 }, // Электростанция
                { x: 11, y: 3 }, // Водоканал
                { x: 11, y: 4 }, // Шанс
                { x: 11, y: 5 }, // Лотерея
                { x: 11, y: 6 }, // Налог
                { x: 11, y: 7 }, // Налог
                { x: 11, y: 8 }, // Тюрьма
                { x: 11, y: 9 }, // Бесплатная парковка
                { x: 10, y: 9 }, // Идите в тюрьму
                { x: 9, y: 9 }, // Новая клетка слева от Идите в тюрьму
                { x: 10, y: 1 }, // Новая клетка под Идите в тюрьму
                { x: 8, y: 9 }, // Улица 8
                { x: 7, y: 9 }, // Улица 9
                { x: 6, y: 9 }, // Улица 10
                { x: 5, y: 9 }, // Улица 11
                { x: 4, y: 9 }, // Улица 12
                { x: 12, y: 11 }, // Новая клетка над Бесплатной парковкой
                { x: 10, y: 12 }, // Новая клетка с улицей
                { x: 11, y: 12 }, // Сдвинутая клетка "Дорога"
            ];
            return positions[index];
        }

        // Функция для обработки попадания на клетку "Лотерея"
        function handleLotteryCell(player) {
            const outcomes = [
                { text: "Вы выиграли 100$!", amount: 100 },
                { text: "Вы выиграли 200$!", amount: 200 },
                { text: "Вы проиграли 50$!", amount: -50 },
                { text: "Вы проиграли 100$!", amount: -100 },
                { text: "Получите бесплатный дом на любой улице!", effect: "freeHouse" },
                { text: "Пропустите ход!", effect: "skipTurn" },
            ];

            const outcome = outcomes[Math.floor(Math.random() * outcomes.length)];

            if (outcome.amount) {
                player.money += outcome.amount;
                addLogMessage(`${player.id} попал на Лотерею: ${outcome.text}`);
            } else if (outcome.effect === "freeHouse") {
                addLogMessage(`${player.id} получил бесплатный дом!`);
            } else if (outcome.effect === "skipTurn") {
                addLogMessage(`${player.id} пропускает ход!`);
                nextTurn();
            }
        }

        // Карточки Шанс
        function drawChanceCard() {
            const cards = [
                "Получите 100$",
                "Перейдите на старт",
                "Отправьтесь в тюрьму",
                "Заплатите 50$",
            ];
            return cards[Math.floor(Math.random() * cards.length)];
        }

        // Карточки Общественной казны
        function drawCommunityChestCard() {
            const cards = [
                "Получите 200$",
                "Заплатите 100$",
                "Перейдите на старт",
                "Отправьтесь в тюрьму",
            ];
            return cards[Math.floor(Math.random() * cards.length)];
        }

        // Обработка банкротства
        function handleBankruptcy(player) {
            addLogMessage(`${player.id} объявил банкротство!`);
            players = players.filter(p => p.id !== player.id);
            if (players.length === 1) {
                addLogMessage(`Игрок ${players[0].id} выиграл!`);
                alert(`Игрок ${players[0].id} выиграл!`);
            }
        }

        // Кнопка "Купить"
        function buyProperty() {
            const currentPlayer = players[currentPlayerIndex];
            const currentCell = getCellData(currentPlayer.position);
            if (currentCell.type === "property" && !currentCell.owner) {
                if (currentPlayer.money >= currentCell.price) {
                    currentPlayer.money -= currentCell.price;
                    currentPlayer.properties.push(currentCell);
                    currentCell.owner = currentPlayer;
                    addLogMessage(`${currentPlayer.id} купил ${currentCell.name} за ${currentCell.price}$`);
                } else {
                    addLogMessage(`${currentPlayer.id} не хватает денег для покупки ${currentCell.name}`);
                }
            } else {
                addLogMessage(`${currentPlayer.id} не может купить эту клетку.`);
            }
        }

        // Кнопка "Пропустить"
        function skipTurn() {
            nextTurn();
        }

        // Кнопка "Торговать"
        function trade() {
            addLogMessage("Торговля пока не реализована.");
        }

        // Кнопка "Строить дома"
        function buildHouses() {
            addLogMessage("Строительство домов пока не реализовано.");
        }

        // Кнопка "Заложить имущество"
        function mortgageProperty() {
            addLogMessage("Залог имущества пока не реализован.");
        }

        // Открытие модального окна настроек сессии
        function openSessionSettings() {
            const modal = document.getElementById('session-settings-modal');
            modal.style.display = 'flex';
        }

        // Закрытие модального окна настроек сессии
        function closeSessionSettings() {
            const modal = document.getElementById('session-settings-modal');
            modal.style.display = 'none';
        }

        // Сохранение настроек сессии
        function saveSessionSettings() {
            gameSettings.startingMoney = parseInt(document.getElementById('startingMoney').value);
            gameSettings.maxHouses = parseInt(document.getElementById('maxHouses').value);
            gameSettings.enableAuctions = document.getElementById('enableAuctions').checked;
            gameSettings.botDifficulty = document.getElementById('botDifficulty').value;

            addLogMessage('Настройки сессии сохранены.');
            closeSessionSettings();
        }
    </script>
</body>
</html>
